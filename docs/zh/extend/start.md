# å¼€å§‹

æƒ³æ‰“é€ ä¸€ä¸ª Flarum æ‰©å±•ï¼Ÿ æ¥å¯¹åœ°æ–¹äº†ï¼ æœ¬æ–‡æ¡£å°†å¸¦æ‚¨äº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œä¹‹åæ‚¨å°†ä»å¤´å¼€å§‹æ‰“é€ æ‚¨çš„ç¬¬ä¸€ä¸ª Flarum æ‰©å±•ã€‚

## æ¶æ„

ä¸ºäº†ç†è§£å¦‚ä½•æ‰©å±• Flarumï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç™½ Flarum æ˜¯å¦‚ä½•æ„å»ºçš„ã€‚

è¦çŸ¥é“ï¼ŒFlarum ä½¿ç”¨äº†ä¸€äº› _ç°ä»£_ è¯­è¨€å’Œå·¥å…·ã€‚ å¦‚æœæ‚¨ä»¥å‰åªæ„å»ºè¿‡ WordPress çš„æ’ä»¶ï¼Œæ‚¨å¯èƒ½ä¼šè§‰å¾—æœ‰ç‚¹åŠ›ä¸ä»å¿ƒã€‚ æ²¡æœ‰å…³ç³» â€”â€” è¿™æ˜¯ä¸€ä¸ªå­¦ä¹ æ–°äº‹ç‰©å’Œæ‰©å±•æŠ€èƒ½çš„å¥½æœºä¼šã€‚ ä¸è¿‡æˆ‘ä»¬å»ºè®®æ‚¨åœ¨å¼€å§‹ä¹‹å‰å…ˆç†Ÿæ‚‰ä¸€ä¸‹ä¸‹é¢æè¿°çš„æŠ€æœ¯ã€‚

Flarum çš„æ„æˆæœ‰ä¸‰å±‚ï¼š

* ç¬¬ä¸€å±‚ï¼Œ**åç«¯**ã€‚ åç«¯ç”¨ [é¢å‘å¯¹è±¡çš„ PHP è¯­è¨€](https://laracasts.com/series/object-oriented-bootcamp-in-php)ç¼–å†™ï¼Œå¹¶é€šè¿‡ [Composer](https://getcomposer.org/) ä½¿ç”¨äº†å¤§é‡çš„ [Laravel](https://laravel.com/) ç»„ä»¶å’Œå…¶ä»–èµ„æºåŒ…ã€‚ You'll also want to familiarize yourself with the concept of [Dependency Injection](https://laravel.com/docs/8.x/container), which is used throughout our backend.

* ç¬¬äºŒå±‚ï¼Œåç«¯å¼€æ”¾çš„ä¸€ä¸ª **å…¬å…± API**ï¼Œå…è®¸å‰ç«¯å®¢æˆ·ç«¯ä¸è®ºå›æ•°æ®è¿›è¡Œäº¤äº’ã€‚ è¯¥æ¥å£æ ¹æ® [JSON:API è§„èŒƒ](https://jsonapi.org/) æ„å»ºã€‚

* ç¬¬ä¸‰å±‚ï¼Œé»˜è®¤çš„ Web ç•Œé¢ï¼Œä¿—ç§° **å‰ç«¯**ã€‚ è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ API çš„ [å•é¡µåº”ç”¨](https://en.wikipedia.org/wiki/Single-page_application)ï¼Œç”±ä¸€ä¸ªç®€å•çš„ç±» React æ¡†æ¶ [Mithril.js](https://mithril.js.org/) æ„å»ºã€‚ It's built with a simple React-like framework called [Mithril.js](https://mithril.js.org).

æ‰©å±•ç¨‹åºé€šå¸¸éœ€è¦ä¸è¿™ä¸‰å±‚éƒ½è¿›è¡Œäº¤äº’æ‰èƒ½æœ‰æ‰€ä¸ºã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³åˆ›å»ºä¸€ä¸ªå¯ä»¥åœ¨ç”¨æˆ·èµ„æ–™ä¸­æ·»åŠ æ–°å±æ€§çš„æ‰©å±•ï¼Œåˆ™éœ€è¦åœ¨ **åç«¯** ä¸­æ·»åŠ ç›¸åº”çš„æ•°æ®åº“ç»“æ„ï¼Œé€šè¿‡ **å…¬å…± API** è°ƒç”¨è¯¥æ•°æ®ï¼Œç„¶ååœ¨ **å‰ç«¯** æ˜¾ç¤ºè¿™ä¸ªæ•°æ®å¹¶å…è®¸ç”¨æˆ·ä¿®æ”¹å®ƒã€‚

é‚£â€¦â€¦ å¦‚ä½•æ‰©å±•è¿™äº›å±‚å‘¢ï¼Ÿ

## æ‰©å±•å™¨

ä¸ºäº†æ‰©å±• Flarumï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° **æ‰©å±•å™¨**ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å®ƒçš„æ¦‚å¿µã€‚ æ‰©å±•å™¨å…¶å®å°±æ˜¯ *å£°æ˜æ€§* å¯¹è±¡ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç®€å•çš„æ–¹å¼æè¿°æƒ³è¦å®ç°çš„å†…å®¹ï¼ˆæ¯”å¦‚å‘è®ºå›æ·»åŠ æ–°çš„è·¯ç”±ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°ä¸»é¢˜å¸–æ—¶æ‰§è¡ŒæŸäº›ä»£ç ï¼‰ã€‚

æ¯ä¸ªæ‰©å±•å™¨éƒ½æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯å¤§ä½“ä¸Šé•¿è¿™æ ·ï¼š However, they will always look somewhat similar to this:

```php
// æ³¨å†Œè¦äº¤ä»˜ç»™å‰ç«¯çš„ JavaScript å’Œ CSS æ–‡ä»¶
(new Extend\Frontend('forum'))
    ->js(__DIR__.'/forum-scripts.js')
    ->css(__DIR__.'/forum-styles.css')
```

æ‚¨é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ‰©å±•å™¨å®ä¾‹ï¼Œç„¶åè°ƒç”¨æ–¹æ³•ä»¥å¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥é…ç½®ã€‚ æ‰€æœ‰æ–¹æ³•éƒ½å°†è¿”å›ç»“æœåˆ°è¯¥æ‰©å±•å™¨æœ¬èº«ï¼Œå› æ­¤æ‚¨åªéœ€è¦é€šè¿‡é“¾å¼æ–¹æ³•è°ƒç”¨å°±å¯ä»¥å®ç°æ‚¨çš„æ•´ä¸ªé…ç½®ã€‚

ä¸ºäº†ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬åœ¨åç«¯ï¼ˆPHPï¼‰å’Œå‰ç«¯ï¼ˆJavaScriptï¼‰éƒ½ä½¿ç”¨äº†æ‰©å±•å™¨çš„æ¦‚å¿µã€‚ æ‚¨åœ¨æ‰©å±•ä¸­åšçš„ _æ¯ä¸€ä»¶äº‹_ éƒ½åº”å½“é€šè¿‡æ‰©å±•å™¨æ¥å®Œæˆï¼Œå› ä¸ºæ‰©å±•å™¨æ˜¯æˆ‘ä»¬ç»™äºˆæ‚¨çš„ **ä¿è¯** â€”â€” ä¿è¯ Flarum å°ç‰ˆæœ¬æ›´æ–°ç»å¯¹ä¸ç ´åæ‚¨çš„æ‰©å±•ã€‚

æ‰€æœ‰ Flarum æ ¸å¿ƒæä¾›çš„å¯ç”¨æ‰©å±•å™¨éƒ½å¯ä»¥åœ¨ [`Extend` å‘½åç©ºé—´](https://github.com/flarum/core/blob/master/src/Extend)[ï¼ˆPHP API æ–‡æ¡£ï¼‰](https://api.docs.flarum.org/php/master/flarum/extend)æ‰¾åˆ°ã€‚

## Hello World

æƒ³äº²çœ¼çœ‹çœ‹ä¸€ä¸ªæ‰©å±•å™¨çš„æ‰§è¡Œï¼Ÿ Flarum å®‰è£…æ ¹ç›®å½•ä¸­çš„ `extend.php` æ˜¯ä¸ºæ‚¨çš„ç«™ç‚¹æ³¨å†Œæ‰©å±•å™¨çš„æœ€ç®€å•çš„é€”å¾„ï¼Œå®ƒåº”è¯¥ä¼šè¿”å›ä¸€ä¸ªæ‰©å±•å™¨å¯¹è±¡çš„æ•°ç»„ã€‚ It should return an array of extender objects. æ‰“å¼€è¯¥æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```php
<?php

use Flarum\Extend;
use Flarum\Frontend\Document;

return [
    (new Extend\Frontend('forum'))
        ->content(function (Document $document) {
            $document->head[] = '<script>alert("ä½ å¥½ï¼Œä¸–ç•Œï¼")</script>';
        })
];
```

ç°åœ¨ï¼Œè®¿é—®æ‚¨çš„è®ºå›ï¼Œæ¥å—çœŸæŒšçš„é—®å€™ï¼ˆå°½ç®¡å¾ˆçªå…€ï¼‰ã€‚ ğŸ‘‹

å¯¹äºç®€å•çš„ç½‘ç«™å®šåˆ¶ï¼Œæ¯”å¦‚æ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„ CSS æˆ– JavaScriptï¼Œæˆ–è€…æ•´åˆæ‚¨ç½‘ç«™çš„è®¤è¯ç³»ç»Ÿï¼Œè®ºå›æ ¹ç›®å½•ä¸‹çš„ `extend.php` æ–‡ä»¶æ˜¯éå¸¸å¥½ç”¨çš„ã€‚ ä½†æ˜¯åœ¨æŸäº›æ—¶å€™ï¼Œæ‚¨çš„è‡ªå®šä¹‰å¯èƒ½ä¼šè¶…å‡ºå®ƒçš„é™åˆ¶èŒƒå›´ã€‚ æˆ–è€…æ‚¨æƒ³å»ºç«‹ä¸€ä¸ªæ‰©å±•ç¨‹åºï¼Œå¹¶åˆ†äº«åˆ°ç¤¾åŒºï¼Œé‚£ä¹ˆæ˜¯æ—¶å€™å»ºç«‹ä¸€ä¸ªæ‰©å±•ç¨‹åºäº†ï¼ Time to build an extension!

## æ‰“åŒ…æ‰©å±•ç¨‹åº

[Composer](https://getcomposer.org) æ˜¯ PHP çš„ä¸€ä¸ªä¾èµ–ç®¡ç†å·¥å…·ã€‚ å®ƒå…è®¸åº”ç”¨ç¨‹åºè½»æ¾åœ°æ‹‰å–å¤–éƒ¨ä»£ç åº“ï¼Œå¹¶ä¿æŒä»–ä»¬æ˜¯æœ€æ–°çš„ï¼Œä»¥ä¾¿åŠæ—¶åº”ç”¨å®‰å…¨è¡¥ä¸å’Œé”™è¯¯ä¿®å¤ã€‚

å¦‚ä¸Šæ‰€è¿°ï¼Œæ¯ä¸ª Flarum æ‰©å±•ç¨‹åºä¹Ÿæ˜¯ä¸€ä¸ª Composer åŒ…ã€‚ è¿™æ„å‘³ç€ä¸€ä¸ªäººå¯ä»¥ã€Œrequireã€æŸä¸ªæ‰©å±•ç¨‹åºï¼ŒComposer ä¼šæŠŠå®ƒæ‹‰å–ç»™ Flarumï¼ŒåŒæ—¶ä½¿æ‰©å±•ç¨‹åºä¿æŒæœ€æ–°ç‰ˆæœ¬ã€‚ Niceï¼

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨æœ¬åœ°å¤„ç†æ‚¨çš„æ‰©å±•ç¨‹åºï¼Œå¹¶å»ºç«‹ä¸€ä¸ª [Composer æœ¬åœ°è·¯å¾„ä»“åº“](https://getcomposer.org/doc/05-repositories.md#path) ä»¥å®‰è£…æ‚¨çš„æœ¬åœ°å‰¯æœ¬ã€‚ åœ¨ Flarum å®‰è£…æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ `packages` æ–‡ä»¶å¤¹ï¼Œç„¶åè¿è¡Œè¿™ä¸ªå‘½ä»¤æ¥å‘Šè¯‰ Composer å®ƒå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°è½¯ä»¶åŒ…ï¼š

```bash
composer config repositories.0 path "packages/*"
```

ç°åœ¨ï¼Œæ¥æ„å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ‰©å±•ç¨‹åºå§ã€‚ åœ¨ `packages` é‡Œé¢ä¸ºæ‚¨çš„æ‰©å±•ç¨‹åºå»ºç«‹ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œå‘½åä¸º `hello-world`ã€‚ æˆ‘ä»¬ä¼šåœ¨é‡Œé¢æ”¾ä¸¤ä¸ªæ–‡ä»¶ï¼š`extend.php` å’Œ `composer.json`ã€‚ è¿™äº›æ–‡ä»¶æ˜¯æ‰©å±•ç¨‹åºçš„å¿ƒè„å’Œçµé­‚ã€‚

### extend.php

æ‰©å±•ç¨‹åºçš„ `extend.php` è·Ÿæ‚¨ç«™ç‚¹æ ¹ç›®å½•ä¸‹çš„é‚£ä¸ªæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ‰©å±•å™¨å¯¹è±¡æ•°ç»„ï¼Œå¹¶å‘Šè¯‰ Flarum æ‚¨æƒ³è¦åšä»€ä¹ˆã€‚ It will return an array of extender objects that tell Flarum what you want to do. ç°åœ¨ï¼Œå°†å‰é¢æˆ‘ä»¬æ“ä½œçš„ `Frontend` æ‰©å±•å™¨ç§»åŠ¨åˆ°è¿™é‡Œã€‚

### composer.json

æˆ‘ä»¬éœ€è¦å‘Šè¯‰ Composer ä¸€äº›æ‚¨çš„è½¯ä»¶åŒ…çš„ä¿¡æ¯ï¼Œåˆ›å»º `composer.json` æ–‡ä»¶å·²å†™å…¥è¿™äº›ä¿¡æ¯ï¼š

```json
{
    "name": "acme/flarum-hello-world",
    "description": "å‘ä¸–ç•Œé—®å¥½ï¼",
    "type": "flarum-extension",
    "require": {
        "flarum/core": ">=0.1.0-beta.16 <=0.1.0"
    },
    "autoload": {
        "psr-4": {"Acme\\HelloWorld\\": "src/"}
    },
    "extra": {
        "flarum-extension": {
            "title": "Hello World",
            "icon": {
                "name": "fas fa-smile",
                "backgroundColor": "#238c59",
                "color": "#fff"
            }
        }
    }
}
```

* **name**ï¼Œåå­—ã€‚ æ˜¯ Composer è½¯ä»¶åŒ…çš„åå­—ã€‚ æ ¼å¼æ˜¯ `ä¾›åº”å•†/åŒ…å`ã€‚
  * æ‚¨éœ€è¦èµ·ä¸€ä¸ªå…¨ä¸–ç•Œç‹¬ä¸€æ— äºŒçš„ä¾›åº”å•†åï¼Œæˆ–è€…å¯ä»¥ç›´æ¥æ²¿ç”¨ GitHub çš„ç”¨æˆ·åã€‚ ä»¥æœ¬æ•™ç¨‹ä¸ºä¾‹ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾ `acme` æ˜¯æ‚¨çš„ä¾›åº”å•†åã€‚
  * æ‚¨åº”è¯¥ç»™åŒ… `åŒ…å` åŠ ä¸Š `flarum-` å‰ç¼€ï¼Œä»¥æŒ‡æ˜æ­¤åŒ…æ˜¯ä¸“é—¨ç»™ Flarum ç”¨çš„ã€‚

* **description**ï¼Œæè¿°ã€‚ ç”¨ä¸€å¥è¯æè¿°è¿™ä¸ªæ‰©å±•ç¨‹åºçš„ä½œç”¨æ˜¯ä»€ä¹ˆã€‚

* **type**ï¼Œç±»å‹ã€‚ åªèƒ½æ˜¯ `flarum-extension`ã€‚ è¿™ç¡®ä¿äº†å½“åˆ«äººã€Œrequireã€æ‚¨çš„æ‰©å±•ç¨‹åºæ—¶ï¼Œèƒ½è¢«æ­£ç¡®è¯†åˆ«ã€‚

* **require**ï¼Œä¾èµ–ã€‚ æè¿°æ‚¨çš„æ‰©å±•ç¨‹åºè‡ªèº«çš„ä¾èµ–å…³ç³»ã€‚
  * æ‚¨éœ€è¦åœ¨è¿™é‡ŒæŒ‡å®šæ‚¨çš„æ‰©å±•ç¨‹åºæ‰€å…¼å®¹çš„ Flarum ç‰ˆæœ¬ã€‚
  * è¿™é‡Œä¹Ÿæ˜¯åˆ—å‡ºæ‚¨çš„ä»£ç éœ€è¦ä½¿ç”¨çš„ Composer å¤–éƒ¨å·¥å…·åº“çš„åœ°æ–¹ã€‚

  ::: warning Carefully choose the Flarum version

  While Flarum is still in beta, we recommend that you declare compatibility only with the current version of Flarum:

    "flarum/core": ">=0.1.0-beta.16 <=0.1.0"

  :::

* **autoload**ï¼Œå®šä¹‰ä¸€ä¸ªä»å‘½åç©ºé—´åˆ°ç›®å½•çš„æ˜ å°„ï¼Œå‘Šè¯‰ Composer åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°æ‰©å±•ç¨‹åºçš„ç±»ã€‚ æ­¤å¤„çš„å‘½åç©ºé—´åº”ä»¥ é©¼<font size=2>å³°</font>å†™<font size=2>æ³•</font> åæ˜ æ‰©å±•ç¨‹åºçš„ä¾›åº”å•†å’ŒåŒ…å.

* **extra.flarum-extension**ï¼ŒåŒ…å«ä¸€äº› Flarum ç‰¹æœ‰çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ‚¨æ‰©å±•ç¨‹åºåœ¨è®ºå›çš„æ˜¾ç¤ºåç§°ä»¥åŠå›¾æ ‡ã€‚
  * **title** æ‚¨çš„æ‰©å±•ç¨‹åºçš„æ˜¾ç¤ºåç§°ã€‚
  * **icon** æ˜¯ä¸€ä¸ªå®šä¹‰æ‚¨æ‰©å±•ç¨‹åºå›¾æ ‡çš„å¯¹è±¡ã€‚ **name** å±æ€§æ˜¯ [Font Awesome å›¾æ ‡å](https://fontawesome.com/icons)ã€‚ å‰©ä¸‹çš„éƒ½è¢«ç”¨ä½œå›¾æ ‡çš„ `style` å±æ€§ã€‚

è¯·å‚é˜… [composer.json æ¨¡å¼](https://getcomposer.org/doc/04-schema.md) æ–‡æ¡£ï¼Œä»¥è·å–æœ‰å…³å¯ä»¥æ·»åŠ åˆ° `composer.json` ä¸­çš„å…¶ä»–å±æ€§çš„ä¿¡æ¯ã€‚

::: tip

Use the [FoF extension generator](https://github.com/FriendsOfFlarum/extension-generator) to automatically create your extension's scaffolding.

:::

### å®‰è£…æ‚¨çš„æ‰©å±•

The final thing we need to do to get up and running is to install your extension. Navigate to the root directory of your Flarum install and run the following command:

```bash
composer require acme/flarum-hello-world *@dev
```

Once that's done, go ahead and fire 'er up on your forum's Administration page, then navigate back to your forum.

*whizzing, whirring, metal clunking*

Woop! Hello to you too, extension!

We're making good progress. We've learned how to set up our extension and use extenders, which opens up a lot of doors. Read on to learn how to extend Flarum's frontend.
